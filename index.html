<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VUMC Kids Check‑In</title>
  <script src="https://labelwriter.com/software/dls/sdk/js/DYMO.Label.Framework.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root { --bg:#0b1728; --card:#0f1e34; --muted:#a8bade; --text:#eaf2ff; --accent:#6fb2ff; --line:rgba(255,255,255,0.08); }
    * { box-sizing: border-box; }
    html, body { height:100%; }
    body { margin:0; font:16px system-ui, sans-serif; background: linear-gradient(180deg,#0b1728,#0a1422); color:var(--text); }
    header { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; background:rgba(255,255,255,0.03); border-bottom:1px solid var(--line); position:sticky; top:0; z-index:5; }
    header h1 { margin:0; font-size:18px; }
    .container { max-width:1100px; margin:16px auto; padding:0 12px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.25); }
    .toolbar { display:flex; flex-wrap:wrap; gap:10px; padding:12px; align-items:center; border-bottom:1px solid var(--line); }
    .toolbar h2 { margin:0 8px 0 0; font-size:16px; font-weight:600; color:#cfe1ff; }
    .toolbar input, .toolbar select, .toolbar button { background:#0c1730; color:var(--text); border:1px solid rgba(255,255,255,0.14); border-radius:10px; padding:10px 12px; font-size:15px; }
    .toolbar button { background: linear-gradient(180deg,#1976ff,#0f63da); border:none; font-weight:700; cursor:pointer; }
    .flex { display:flex; gap:16px; }
    .left, .right { padding:16px; }
    .left { flex: 1 1 640px; }
    .right { width:360px; background:#0c1730; border-left:1px solid var(--line); }
    .list { max-height:64vh; overflow:auto; border:1px solid var(--line); border-radius:12px; }
    .kid { display:flex; justify-content:space-between; gap:10px; padding:10px 12px; border-bottom:1px solid var(--line); }
    .kid .meta { color:var(--muted); font-size:12px; }
    .kid button { padding:12px; border:none; border-radius:10px; background:#1a7cff; color:white; font-weight:700; cursor:pointer; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: none; align-items: center; justify-content: center; z-index: 50; }
    .modal.open { display: flex; }
    .dialog { width: 640px; max-width: 96vw; background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 16px; color:var(--text); }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .grid .full { grid-column: 1 / -1; }
    .dialog input, .dialog select { width: 100%; background:#0c1730; color:var(--text); border:1px solid rgba(255,255,255,0.14); border-radius:10px; padding:12px 14px; font-size:16px; }
    .dialog .row { display:flex; gap:10px; justify-content:flex-end; margin-top: 12px; }
    .btn { padding:12px 16px; border:none; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn.primary { background: linear-gradient(180deg,#1976ff,#0f63da); color:#fff; }
    .btn.ghost { background: transparent; color: var(--text); border:1px solid rgba(255,255,255,0.18); }
    video { width:100%; border:1px solid var(--line); border-radius:12px; }
  </style>
</head>
<body>
  <header>
    <h1>VUMC Kids Check‑In</h1>
    <div id="printerStatus">Printer: <span class="muted">checking…</span></div>
  </header>
  <div class="container">
    <div class="card">
      <div class="toolbar">
        <h2>Staff Sign‑In</h2>
        <input id="pin" type="password" placeholder="Staff PIN" />
        <select id="service"><option>9:30 AM</option><option>10:30 AM</option></select>
        <input id="search" type="search" placeholder="Search child name…" />
        <select id="group"><option value="">All Groups</option><option>Nursery</option><option>Pre‑K</option><option>Kids Church</option></select>
        <button id="signInBtn" type="button">Unlock</button>
        <button id="guestBtn" class="btn primary" disabled>Guest Check‑In</button>
        <button id="photoBtn" class="btn ghost" disabled>Take Photo</button>
      </div>
      <div class="flex">
        <div class="left">
          <div class="list" id="list"></div>
        </div>
        <aside class="right">
          <h3>Print Preview</h3>
          <div id="qrPreview"></div>
          <div id="signed">locked</div>
        </aside>
      </div>
    </div>
  </div>
  <!-- Guest Modal -->
  <div class="modal" id="guestModal">
    <div class="dialog">
      <h3>Quick Guest Check‑In</h3>
      <div class="grid">
        <input id="g_parent_first" placeholder="Parent First (optional)" />
        <input id="g_parent_last" placeholder="Parent Last (optional)" />
        <input id="g_child_first" placeholder="Child First *" />
        <input id="g_child_last" placeholder="Child Last (optional)" />
        <select id="g_group" class="full"><option>Nursery</option><option>Pre‑K</option><option>Kids Church</option></select>
        <input id="g_allergies" class="full" placeholder="Allergies / Notes (optional)" />
        <input id="g_phone" class="full" placeholder="Parent Mobile (required)" required />
      </div>
      <div class="row">
        <button class="btn ghost" id="g_cancel" type="button">Cancel</button>
        <button class="btn primary" id="g_submit" type="button">Print Guest Label</button>
      </div>
    </div>
  </div>
  <!-- Photo Modal -->
  <div class="modal" id="photoModal">
    <div class="dialog">
      <h3>Photo Capture</h3>
      <video id="cam" autoplay playsinline></video>
      <div class="row">
        <button class="btn ghost" id="snapChild" type="button">Save Child</button>
        <button class="btn ghost" id="snapAdult" type="button">Save Adult</button>
        <button class="btn primary" id="closePhoto" type="button">Done</button>
      </div>
    </div>
  </div>
  <script>
    const REQUIRED_PIN = "2301";
    const el = sel => document.querySelector(sel);
    const els = sel => Array.from(document.querySelectorAll(sel));
    let unlocked = false, currentKid = null, camStream = null;

    el('#signInBtn').addEventListener('click', () => {
      const pin = el('#pin').value.trim();
      if (!pin) return alert('Enter PIN');
      if (pin !== REQUIRED_PIN) return alert('Invalid PIN');
      unlocked = true;
      el('#signed').textContent = 'unlocked';
      els('.kid button').forEach(b=>b.disabled=false);
      el('#guestBtn').disabled=false;
      el('#photoBtn').disabled=false;
    });

    el('#guestBtn').addEventListener('click', () => { if(unlocked) el('#guestModal').classList.add('open'); });
    el('#g_cancel').addEventListener('click', () => el('#guestModal').classList.remove('open'));
    el('#g_submit').addEventListener('click', () => { el('#guestModal').classList.remove('open'); alert('Guest added'); });

    el('#photoBtn').addEventListener('click', async () => {
      if (!unlocked) return alert('Unlock first.');
      if (!currentKid) return alert('Check in a child first.');
      if (!(location.protocol==='https:'||location.hostname==='localhost')) { alert('Camera requires HTTPS.'); return; }
      el('#photoModal').classList.add('open');
      try { camStream = await navigator.mediaDevices.getUserMedia({video:true}); el('#cam').srcObject = camStream; await el('#cam').play(); }
      catch(e){ alert('Camera not available'); }
    });
    el('#closePhoto').addEventListener('click', () => { el('#photoModal').classList.remove('open'); if(camStream){ camStream.getTracks().forEach(t=>t.stop()); camStream=null; } });
  </script>
</body>
</html>
